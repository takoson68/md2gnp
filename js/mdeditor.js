var mdBoxApp=new Vue({el:"#mdBox",data:{urlBox:"URL_head",isDefault:"MyData.isDefault",mdData:"",renderData:[],endData:[],iArr:[["star","00 ~ 08"],["wb_sunny","08 ~ 12"],["brightness_high","12 ~ 18"],["brightness_2","18 ~ 24"]],cName:[],cData:[],setComment:[""],commentBox:[""],mtChart:null},created:function(){this.getMd()},watch:{mdData:{handler:function(t,e){e!=[]&&this.mdToJson(t)},immediate:!1,deep:!1}},computed:{},mounted(){this.dragBox()},methods:{async getMd(){axios.get("../md.text").then((t=>{this.mdData=t.data,this.mdToJson(t.data)})).catch((function(t){console.log(t)}))},mdToJson(t){let e=t.replaceAll("\\\\n","\n").replace("\n`","").replace(/^\s*|\s*$/g,"");e.replace("+ `","+ `\n"),e=t.split("\n");let a=[];e.forEach((t=>{a=[...a,t.split("+ ")[1]]})),a=a.filter((t=>t));var i=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/,l=[];let n=[];a.forEach(((t,e)=>{i.test(t.substring(1,11))?(isNaN(1*t.substring(12,14))&&(t=t.slice(0,11)+" 25:00:00"+t.slice(11)),n.length>0?(0==l.length?(l=[{}])[0].start=n:l[l.length-1].ann=[...n],l=[...l,{time:t.substring(1,20).replace(/^\s*|\s*$/g,"").split(" "),con:t.substring(21).replace(/^\s*|\s*$/g,"")}],n=[]):l=[...l,{time:t.substring(1,20).replace(/^\s*|\s*$/g,"").split(" "),con:t.substring(21).replace(/^\s*|\s*$/g,"")}]):e==a.length-1?(l[l.length-1].ann=[...n,t],n=[]):n=[...n,t]})),this.renderData=l,this.filterTime(l)},filterTime(t){let e={};t.forEach(((t,a)=>{t.time?(null==e[t.time[0]]&&(e[t.time[0]]=[]),e[t.time[0]].push({time:t.time[1],con:t.con,ann:t.ann})):e["0000-00-00"]=[{start:t.start,time:"00:00:01"}]}));let a=Object.keys(e).sort((function(t,e){return t.replaceAll("-","")-e.replaceAll("-","")}));var i=[];a.forEach((t=>{let a=[];a=e[t].sort((function(t,e){return t.time.replaceAll(":","")-e.time.replaceAll(":","")})),i=[...i,[t,a]]})),i.forEach((t=>{t[1].forEach((e=>{1*e.time.split(":")[0]==25&&(t[1]=[t[1].pop(),...t[1]])}))})),this.endData=i,this.makeChart(i)},makeChart(t){let e={},a="";var i=0;let l="",n="",o=0;var r=[];t.forEach(((t,s)=>{"0000-00-00"!==t[0]&&t[1].forEach(((s,c)=>{let m=s.time.split(":")[0],d=!1;if("25"==m&&(m="12",d=!0,r.push([t[0],s.con])),l=t[0]+" "+m,""!==a&&""!==l){if((i=this.calculatingTime(a+" "+n,l))>1&&i<=6){let a=Math.ceil(i);for(let i=1;i<a;i++){let a=parseInt(n)+i;e[t[0]+" "+a]=0}}if(i>6&&i<=12){let a=Math.ceil(i/2);for(let i=1;i<a;i++){let a=parseInt(n)+2*i;e[t[0]+" "+a]=0}}if(i>12&&i<=48){let a=Math.ceil(i/6);for(let i=1;i<a;i++)e[t[0]+" + "+6*i+"hr"]=0}let o=720;if(i>48&&i<=o){let a=Math.ceil(i/48);for(let i=1;i<a;i++)e[t[0]+" + "+2*i+"day"]=0}if(i>o){let a=Math.ceil(i/o);for(let i=1;i<a;i++)e[t[0]+" + "+i+"mo."]=0}}m!==n&&(o=0,n=m),o++,d?(o=0,e[t[0]+" "]=1,n="12"):e[l]=o,a=t[0]})),o=0})),this.cName=Object.keys(e);let s=[];this.cName.forEach((t=>{s=[...s,e[t]]})),this.cData=s,this.setComment=this.cName.map((t=>"+"!==t[0]?t:"")),this.commentBox=this.setComment.map((()=>["",-2])),r.forEach((t=>{let e=this.setComment.indexOf(t[0]+" ");e>=0&&(this.commentBox[e][0]=t[1])})),this.renderChart()},calculatingTime(t,e){var a=36e5;let i=e+":00:00",l=(t+":00:00").replaceAll("-","/"),n=i.replaceAll("-","/");var o=new Date(l),r=new Date(n)-o,s=Math.floor(r/a);return s>0&&(r-=s*a),s},cutTime:t=>t.replace("-"," ").replace("-","/").split(" "),"SelectＰic"(t){let e=parseInt(t.split(":")[0]);return e<8?"star":e<12?"wb_sunny":e<18?"brightness_high":e<24?"brightness_2":"settings_suggest"},renderChart(){var t=document.getElementById("myChart"),e=this.commentBox;this.mtChart=new Chart(t,{responsive:!0,type:"line",data:{labels:this.cName,datasets:[{label:"事件次數統計",data:this.cData,backgroundColor:"rgba(139, 18, 219, 0.3)",borderColor:"rgba(139, 18, 219, 0.8)",borderWidth:1}]},options:{scales:{yAxes:[{stacked:!0,id:"y-axis-1",ticks:{min:0,beginAtZero:!0,userCallback:function(t,e,a){if(Math.floor(t)===t)return t}}}],xAxes:[{ticks:{minRotation:65,autoskip:!1,display:!0,autoSkipPadding:10}}]},elements:{line:{tension:1e-6}},hover:{animationDuration:0},animation:{onComplete:function(){var a=this.chart;(t=a.ctx).font=Chart.helpers.fontString(Chart.defaults.global.defaultFontSize,Chart.defaults.global.defaultFontStyle,Chart.defaults.global.defaultFontFamily),t.fillStyle="black",t.textAlign="center",t.textBaseline="bottom";var i=!1;this.data.datasets.forEach((function(l,n){var o=a.controller.getDatasetMeta(n);let r=o.data.length;o.data.forEach((function(a,n){var o=l.data[n];o=0==o?"":o,t.fillText(o,a._model.x,a._model.y-5);let s=e[n][0];if(s){let l=t.measureText(s).width,o=0;i||(l*=1.11,i=!0),0==n?(t.textAlign="start",o=a._model.x-5):n==r-1?(t.textAlign="end",o=a._model.x-l-5):(t.textAlign="center",o=a._model.x-l/2-5);let m=e[n][1];t.fillStyle="#000000",t.beginPath(),t.strokeStyle="#fc7232",t.lineJoin="round",t.lineWidth="8",t.fillStyle="#fc7232";let d=m>0?10*m+14:10*m-12;t.fillRect(a._model.x-2,a._model.y-d,4,10*m-6),t.strokeRect(o,a._model.y-10*m-10,l+10,18),t.fillRect(o,a._model.y-10*m-10,l+10,18);var c=t.createLinearGradient(o,a._model.y-10*m-10,o,a._model.y-10*m+9);c.addColorStop(0,"#fc7232"),c.addColorStop(.5,"#e23a2e"),c.addColorStop(1,"#fc7232"),t.fillStyle=c,t.fillRect(o,a._model.y-10*m-10,l+10,18),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#ffffff",t.font="10pt Arial",t.fillText(s,a._model.x,a._model.y-(4+10*(m-1))),t.stroke(),t.fillStyle="#000000",Previous=n}}))}))}}}})},dragBox(){var t;let e=document.querySelector("#printable"),a=document.querySelector(".dragBox");function i(a){x=a.clientX-startX,e.style.width=t-x+"px"}function l(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",l),mdBoxApp.writeCom()}a.addEventListener("mousedown",(function(n){t=e.offsetWidth,n.preventDefault(),startX=n.clientX-a.offsetLeft,document.addEventListener("mousemove",i),document.addEventListener("mouseup",l)}))},writeCom(){this.mtChart.destroy(),this.renderChart()},pickMeWord(t){let e=t,a=!1;return e=e.replace(/`/g,(function(){return a=!a,a?"<em>":"</em>"})),e}}}),fn1=t=>Promise.resolve(t),MdText=document.querySelector(".mdTopng");let Printable=document.querySelector("#printable");function screenshot(){let t=window.prompt("請輸入檔案名稱","");if(t){window.confirm("放大攻擊次數統計圖？")?bigPic(t):attackHistory(t)}}function bigPic(t){MdText.setAttribute("style","flex: 0 0 0px !important; min-width: 0px !important;"),Printable.setAttribute("style","width: 100% !important;"),mdBoxApp.writeCom(),setTimeout((function(){attackHistory(t)}),2500)}function attackHistory(t){TakePic("myChart","_line",t),TakePic("attackHistory","_history",t),setTimeout((function(){MdText.setAttribute("style","display:block;min-width: 200px !important;"),Printable.setAttribute("style","width: 900px !important;"),mdBoxApp.writeCom()}),500)}function TakePic(t,e,a){html2canvas(document.getElementById(t)).then((function(t){document.body.appendChild(t);let i=document.createElement("a");i.href=t.toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream"),i.download=a+e+".jpg",i.click()}))}